# The "Observer" Design Pattern
- The observer pattern allows a publisher (an owner of data) to send notifications to Subscribers (those who are interested in the data) BUT without being directly coupled to them
	- e.g. thing about GUI event listeners being notified when a button has been clicked
- Helps prevent problems related to OCP (adding new subscribers), DIP (dependency on specific subscribers) as well as code smells related to tight coupling
## Example
- In out navigation app, we send notifications to other services to keep them up to date of the user's location in case they need to update or respond. e.g.
	- A map updates to show the new location
	- A voice component needs to trigger a new audio instruction (e.g. "Turn Left")
	- A "haptic" component needs to give a vibration to alert the user when to turn
### Original Design
```Java
public class NavigationApp {
	MappingComponent map = new MappingComponent();
	VoiceComponent voice = new VoiceComponent();
	HapticComponent haptics = new HapticComponent();
	
	// process an update in the user's location
	public void updateLocation(lat, long) {
		// do whatever processing the
		// Navigation App needs to do
		// with the updated location
		
		// notify other components of
		// the updated location too
		map.updateLocation(lat, long);
		voice.updateLocation(lat, long);
		haptics.updateLocation(lat, long);
	}
}
```
- Dependency Inversion Issues (dependent on concrete types)
- Divergent Change / Single Responsibility Issues
- Open but not closed to new "subscribers"
- Smell: Data Bundles? e.g. lat and long could be in a Location class?
### New Design
- The mapping component, voice component, and haptics component are all observers: they are interested in observing, or listening to, or being notified and kept up to date about changes in the user location
- In a more generalised sense, we could refer to them as "Location Listeners"
- Create an interface to represent this behaviour, where each Listener wants to listen out for updates on the user Location
```Java
// generic, parent version anything that
// wishes to "listen" to location updates
public interface LocationListener {
	public void update(Location location);
}
```
- Components inherit/implement the Location Listener behaviour
```Java
public MappingComponent implements LocationListener {
	public void update(Location location) {
		// logic here to handle map updates
	}
}

public VoiceComponent implements LocationListener {
	public void update(Location location) {
		// logic here to handle voice updates
	}
}

public HapticsComponent implements LocationListener {
	public void update(Location location) {
		// logic here to handle haptics updates
	}
}
```
- Integrate listeners into the navigation app
```Java
public class NavigationApp {
	// a list of subscribers (listeners)
	List<LocationListener> listeners = new List<LocationListener>();
	
	// add a subscriber / listener
	public void addListener(LocationListener listener) {
		listeners.add(listener);
	}
	
	// process an update in the user's location
	public void updateLocation(Location location) {
		// notify listeners of updated location
		for (LocationListener listener : listeners) {
			listener.update(location);
		}
	}
}
```
- Create and use listeners
```Java
// Create the navigation app
NavigationApp app = new NavigationApp();

// add listeners for mapping and haptics
MappingComponent mc = new MappingComponent();
HapticsComponent hc = new HapticComponent();
app.addListener(mc);
app.addListener(hc);

// Later, an update in the user's location is detected
Location newLocation;
newLoction.setLatitude(usersNewLat);
newLocation.setLongitude(usersNewLong);

// notify the app
app.updateLocation(newLocation);
```
### Benefits
- Location Listeners can be added, removed, and swapped around easily in the future with no direct impact to the NavigationApp class - promoting extensibility and maintainability
- Code smells removed: no tight coupling to specific listeners, no divergent changes caused by a mixture of different components having to be accommodated in the code
- In summary, the "publisher" of the data (Navigation App with location updates) has been decoupled from its "subscribers"